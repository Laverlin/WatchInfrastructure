- name: mount shared drive
  hosts: all
  become: yes
  tasks:
    - name: make dir
      ansible.builtin.file:
        path: /shared-data
        state: directory

    - name: setup boot mount
      ansible.builtin.lineinfile:
        path: /etc/fstab
        line: LABEL=data-disk /shared-data ext4 defaults,nofail 0 0

    - name: mount 
      command: "mount -a"

- name: prepare os
  hosts: all
  become: yes
  tasks:
  - name: Disable swap for current session
    command: swapoff -a

  - name: Disable swap permanently, persist reboots
    replace:
      path: /etc/fstab
      regexp: '^(\s*)([^#\n]+\s+)(\w+\s+)swap(\s+.*)$'
      replace: '#\1\2\3swap\4'
      backup: yes