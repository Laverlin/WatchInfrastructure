## Setup worker node 
##
- name: Setup worker node
  hosts: worker
  become: true
  become_method: sudo
  become_user: root
  gather_facts: true
       
  tasks:

    - name: Copy join command to worker nodes
      ansible.builtin.copy:
        src: ~/tmp/kubernetes_join_command
        dest: /tmp/kubernetes_join_command
        force: true
        mode: 0777   

    - name: Join the Worker nodes with master
      shell: sh /tmp/kubernetes_join_command
      register: joined_or_not
      args:
        creates: /etc/kubernetes/kubelet.conf

    - debug:
        msg: "{{ joined_or_not.stdout }}"